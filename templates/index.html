<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频音频处理工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        danger: '#F87272',
                        warning: '#FBBD23',
                        dark: '#1E293B',
                        darkBg: '#121212',
                        darkCard: '#1E1E1E'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .shadow-card {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .dark-shadow-card {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-inter min-h-screen flex flex-col transition-all-300" id="app-body">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-md fixed w-full z-10 transition-all-300" id="main-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fa fa-video-camera text-primary text-2xl mr-2"></i>
                        <span class="font-bold text-xl text-dark transition-all-300" id="nav-title">MediaMaster</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#convert" class="border-primary text-dark border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium transition-all-300">
                            <i class="fa fa-exchange mr-1"></i> 格式转换
                        </a>
                        <a href="#compress" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium transition-all-300">
                            <i class="fa fa-compress mr-1"></i> 压缩
                        </a>
                        <a href="#trim" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium transition-all-300">
                            <i class="fa fa-scissors mr-1"></i> 剪辑
                        </a>
                        <a href="#history" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 px-1 pt-1 inline-flex items-center text-sm font-medium transition-all-300">
                            <i class="fa fa-history mr-1"></i> 历史记录
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <!-- 日夜模式切换按钮 -->
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 transition-all-300 mr-2">
                        <i class="fa fa-moon-o text-xl text-dark transition-all-300" id="theme-icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="flex-grow pt-20 pb-10 transition-all-300" id="main-content">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- 欢迎部分 -->
            <section class="mb-10">
                <div class="text-center">
                    <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-dark mb-4 transition-all-300" id="main-title">
                        视频音频处理工具
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto transition-all-300" id="main-desc">
                        简单、高效的在线视频音频处理解决方案，支持格式转换、压缩和剪辑功能
                    </p>
                </div>
            </section>

            <!-- 文件上传部分 -->
            <section id="upload" class="mb-10">
                <div class="bg-white rounded-xl shadow-card p-6 transition-all-300 hover:shadow-lg" id="upload-card">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center transition-all-300">
                        <i class="fa fa-upload text-primary mr-2"></i> 上传文件
                    </h2>
                    
                    <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-primary transition-all-300">
                        <input type="file" id="file-input" class="hidden" accept="video/*, audio/*">
                        <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-4 transition-all-300"></i>
                        <p class="text-gray-600 mb-2 transition-all-300">拖放文件到此处，或</p>
                        <button id="select-file-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-md text-sm font-medium transition-all-300">
                            <i class="fa fa-file-o mr-1"></i> 选择文件
                        </button>
                        <p class="text-gray-500 text-sm mt-4 transition-all-300">支持的视频格式: MP4, AVI, MOV, MKV, WebM</p>
                        <p class="text-gray-500 text-sm transition-all-300">支持的音频格式: MP3, WAV, OGG, FLAC, M4A</p>
                    </div>
                    
                    <div id="file-info" class="mt-6 hidden">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-md bg-gray-100 flex items-center justify-center mr-4 transition-all-300">
                                <i id="file-icon" class="fa fa-file-video-o text-primary text-xl"></i>
                            </div>
                            <div class="flex-grow">
                                <h3 id="file-name" class="font-medium text-dark truncate transition-all-300"></h3>
                                <p id="file-size" class="text-gray-500 text-sm transition-all-300"></p>
                            </div>
                            <button id="remove-file-btn" class="text-gray-400 hover:text-danger transition-all-300">
                                <i class="fa fa-times-circle text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 处理选项卡 -->
            <section class="mb-10">
                <div class="bg-white rounded-xl shadow-card overflow-hidden transition-all-300" id="process-card">
                    <div class="border-b border-gray-200 transition-all-300">
                        <nav class="-mb-px flex" aria-label="Tabs">
                            <button id="tab-convert" class="border-primary text-primary whitespace-nowrap px-4 py-4 text-sm font-medium border-b-2 transition-all-300">
                                <i class="fa fa-exchange mr-1"></i> 格式转换
                            </button>
                            <button id="tab-compress" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap px-4 py-4 text-sm font-medium border-b-2 transition-all-300">
                                <i class="fa fa-compress mr-1"></i> 压缩
                            </button>
                            <button id="tab-trim" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap px-4 py-4 text-sm font-medium border-b-2 transition-all-300">
                                <i class="fa fa-scissors mr-1"></i> 剪辑
                            </button>
                        </nav>
                    </div>
                    
                    <!-- 格式转换选项 -->
                    <div id="content-convert" class="p-6 transition-all-300">
                        <h3 class="text-lg font-medium text-dark mb-4 transition-all-300">转换为</h3>
                        
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6">
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-video-o text-red-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">MP4</p>
                                <input type="radio" name="format" value="mp4" class="hidden" checked>
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-video-o text-blue-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">AVI</p>
                                <input type="radio" name="format" value="avi" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-video-o text-green-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">MOV</p>
                                <input type="radio" name="format" value="mov" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-video-o text-purple-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">MKV</p>
                                <input type="radio" name="format" value="mkv" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-audio-o text-yellow-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">MP3</p>
                                <input type="radio" name="format" value="mp3" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-audio-o text-indigo-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">WAV</p>
                                <input type="radio" name="format" value="wav" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-audio-o text-pink-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">OGG</p>
                                <input type="radio" name="format" value="ogg" class="hidden">
                            </div>
                            <div class="format-option bg-white border border-gray-200 rounded-lg p-4 text-center cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="text-3xl mb-2">
                                    <i class="fa fa-file-audio-o text-teal-500"></i>
                                </div>
                                <p class="text-sm font-medium transition-all-300">FLAC</p>
                                <input type="radio" name="format" value="flac" class="hidden">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 压缩选项 -->
                    <div id="content-compress" class="p-6 hidden transition-all-300">
                        <h3 class="text-lg font-medium text-dark mb-4 transition-all-300">压缩质量</h3>
                        
                        <div class="space-y-4 mb-6">
                            <div class="quality-option flex items-center p-4 bg-white border border-gray-200 rounded-lg cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="w-6 h-6 rounded-full border-2 border-gray-300 mr-3 flex items-center justify-center transition-all-300">
                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                </div>
                                <div>
                                    <h4 class="font-medium transition-all-300">高质量 (文件大)</h4>
                                    <p class="text-sm text-gray-500 transition-all-300">保持原始质量，文件大小基本不变</p>
                                </div>
                                <input type="radio" name="quality" value="high" class="hidden" checked>
                            </div>
                            
                            <div class="quality-option flex items-center p-4 bg-white border border-gray-200 rounded-lg cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="w-6 h-6 rounded-full border-2 border-gray-300 mr-3 flex items-center justify-center transition-all-300">
                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                </div>
                                <div>
                                    <h4 class="font-medium transition-all-300">中等质量 (平衡)</h4>
                                    <p class="text-sm text-gray-500 transition-all-300">显著减小文件大小，同时保持良好质量</p>
                                </div>
                                <input type="radio" name="quality" value="medium" class="hidden">
                            </div>
                            
                            <div class="quality-option flex items-center p-4 bg-white border border-gray-200 rounded-lg cursor-pointer hover:border-primary hover:bg-gray-50 transition-all-300">
                                <div class="w-6 h-6 rounded-full border-2 border-gray-300 mr-3 flex items-center justify-center transition-all-300">
                                    <div class="w-3 h-3 rounded-full bg-primary hidden"></div>
                                </div>
                                <div>
                                    <h4 class="font-medium transition-all-300">低质量 (文件小)</h4>
                                    <p class="text-sm text-gray-500 transition-all-300">大幅减小文件大小，质量有所下降</p>
                                </div>
                                <input type="radio" name="quality" value="low" class="hidden">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 剪辑选项 -->
                    <div id="content-trim" class="p-6 hidden transition-all-300">
                        <h3 class="text-lg font-medium text-dark mb-4 transition-all-300">剪辑视频/音频</h3>
                        
                        <div class="space-y-6 mb-6">
                            <div class="flex items-center">
                                <label class="w-24 text-gray-700 transition-all-300">开始时间:</label>
                                <input type="text" id="start-time" placeholder="00:00:00" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all-300">
                            </div>
                            
                            <div class="flex items-center">
                                <label class="w-24 text-gray-700 transition-all-300">结束时间:</label>
                                <input type="text" id="end-time" placeholder="00:00:00" class="flex-grow border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all-300">
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg transition-all-300">
                                <p class="text-sm text-gray-600 mb-2 transition-all-300">时间格式说明:</p>
                                <ul class="text-xs text-gray-500 list-disc pl-5 space-y-1 transition-all-300">
                                    <li>使用格式: HH:MM:SS (时:分:秒)</li>
                                    <li>例如: 00:01:30 表示1分30秒</li>
                                    <li>留空结束时间表示从开始时间到文件末尾</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 处理按钮 -->
                    <div class="p-6 border-t border-gray-200 bg-gray-50 transition-all-300">
                        <button id="process-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-md text-sm font-medium transition-all-300 flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fa fa-cog mr-2"></i>
                            <span>开始处理</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 处理结果 -->
            <section id="result" class="mb-10 hidden">
                <div class="bg-white rounded-xl shadow-card p-6 transition-all-300" id="result-card">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center transition-all-300">
                        <i class="fa fa-check-circle text-secondary mr-2"></i> 处理完成
                    </h2>
                    
                    <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
                        <div class="w-full md:w-2/3">
                            <div id="preview-container" class="bg-gray-100 rounded-lg overflow-hidden relative aspect-video mb-4 transition-all-300">
                                <video id="result-video" class="w-full h-full object-contain" controls></video>
                                <audio id="result-audio" class="w-full" controls></audio>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <a id="download-btn" href="#" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-md text-sm font-medium transition-all-300 flex items-center">
                                    <i class="fa fa-download mr-1"></i> 下载文件
                                </a>
                                <button id="new-task-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium transition-all-300 flex items-center">
                                    <i class="fa fa-plus mr-1"></i> 新任务
                                </button>
                            </div>
                        </div>
                        
                        <div class="w-full md:w-1/3 bg-gray-50 p-4 rounded-lg transition-all-300">
                            <h3 class="font-medium text-dark mb-3 transition-all-300">处理信息</h3>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600 transition-all-300">输入文件名:</span>
                                    <span id="info-input-file" class="font-medium transition-all-300"></span>
                                </div>
                                
                                <div class="flex justify-between">
                                    <span class="text-gray-600 transition-all-300">输出格式:</span>
                                    <span id="info-output-format" class="font-medium transition-all-300"></span>
                                </div>
                                
                                <div class="flex justify-between">
                                    <span class="text-gray-600 transition-all-300">处理类型:</span>
                                    <span id="info-process-type" class="font-medium transition-all-300"></span>
                                </div>
                                
                                <div class="flex justify-between">
                                    <span class="text-gray-600 transition-all-300">处理时间:</span>
                                    <span id="info-processing-time" class="font-medium transition-all-300"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 处理进度 -->
            <section id="processing" class="mb-10 hidden">
                <div class="bg-white rounded-xl shadow-card p-6 transition-all-300" id="processing-card">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center transition-all-300">
                        <i class="fa fa-spinner fa-spin text-primary mr-2"></i> 正在处理
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600 transition-all-300">处理进度</span>
                                <span id="progress-percentage" class="font-medium transition-all-300">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5 transition-all-300">
                                <div id="progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg transition-all-300">
                            <h3 class="font-medium text-dark mb-2 transition-all-300">处理信息</h3>
                            <div id="processing-info" class="text-sm text-gray-600 space-y-1 transition-all-300">
                                <p>正在准备处理...</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button id="cancel-task-btn" class="text-gray-700 hover:text-danger transition-all-300 flex items-center">
                                <i class="fa fa-times mr-1"></i> 取消任务
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 历史记录 -->
            <section id="history" class="mb-10">
                <div class="bg-white rounded-xl shadow-card p-6 transition-all-300" id="history-card">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center transition-all-300">
                        <i class="fa fa-history text-primary mr-2"></i> 处理历史
                    </h2>
                    
                    <div id="history-container" class="space-y-4">
                        <div class="text-center text-gray-500 py-8 transition-all-300">
                            <i class="fa fa-clock-o text-3xl mb-3 transition-all-300"></i>
                            <p class="transition-all-300">暂无处理历史</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8 transition-all-300" id="main-footer">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fa fa-video-camera text-primary text-2xl mr-2"></i>
                        <span class="font-bold text-xl">MediaMaster</span>
                    </div>
                    <p class="text-gray-400 text-sm mt-1">简单高效的视频音频处理工具</p>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-6 pt-6 text-center text-gray-400 text-sm transition-all-300">
                <p>© 2025 版权所有 johngko 与 豆包合作</p>
            </div>
        </div>
    </footer>

    <!-- 脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 日夜模式切换功能
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const appBody = document.getElementById('app-body');
            const mainNav = document.getElementById('main-nav');
            const navTitle = document.getElementById('nav-title');
            const mainContent = document.getElementById('main-content');
            const mainTitle = document.getElementById('main-title');
            const mainDesc = document.getElementById('main-desc');
            const mainFooter = document.getElementById('main-footer');
            
            // 所有需要切换主题的卡片元素
            const themeCards = [
                document.getElementById('upload-card'),
                document.getElementById('process-card'),
                document.getElementById('result-card'),
                document.getElementById('processing-card'),
                document.getElementById('history-card')
            ];
            
            // 检查本地存储中的主题偏好
            let isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            // 初始化主题
            if (isDarkMode) {
                enableDarkMode();
            }
            
            // 绑定主题切换事件
            themeToggle.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                if (isDarkMode) {
                    enableDarkMode();
                } else {
                    disableDarkMode();
                }
                // 保存主题偏好
                localStorage.setItem('darkMode', isDarkMode);
            });
            
            // 启用暗黑模式
            function enableDarkMode() {
                themeIcon.classList.remove('fa-moon-o');
                themeIcon.classList.add('fa-sun-o');
                themeIcon.classList.remove('text-dark');
                themeIcon.classList.add('text-yellow-400');
                
                appBody.classList.remove('bg-gray-50');
                appBody.classList.add('bg-darkBg', 'text-white');
                
                mainNav.classList.remove('bg-white', 'shadow-md');
                mainNav.classList.add('bg-darkCard', 'shadow-lg');
                
                navTitle.classList.remove('text-dark');
                navTitle.classList.add('text-white');
                
                mainTitle.classList.remove('text-dark');
                mainTitle.classList.add('text-white');
                
                mainDesc.classList.remove('text-gray-600');
                mainDesc.classList.add('text-gray-300');
                
                mainFooter.classList.remove('bg-dark');
                mainFooter.classList.add('bg-darkCard');
                
                // 更新所有卡片样式
                themeCards.forEach(card => {
                    if (card) {
                        card.classList.remove('bg-white', 'shadow-card');
                        card.classList.add('bg-darkCard', 'dark-shadow-card');
                    }
                });
                
                // 更新所有文本元素样式
                document.querySelectorAll('p, h2, h3, h4, span, label').forEach(el => {
                    if (el.style.color !== 'rgb(22, 93, 255)' && // 排除主色调文本
                        !el.classList.contains('text-primary') && 
                        !el.classList.contains('text-secondary') &&
                        !el.classList.contains('text-danger')) {
                        
                        el.classList.remove('text-gray-600', 'text-gray-500', 'text-dark');
                        el.classList.add('text-gray-300');
                    }
                });
                
                // 更新输入框样式
                document.querySelectorAll('input').forEach(input => {
                    input.classList.remove('border-gray-300', 'bg-white');
                    input.classList.add('border-gray-700', 'bg-gray-800', 'text-white');
                });
                
                // 更新各种背景元素
                document.querySelectorAll('.bg-gray-50, .bg-gray-100, .bg-gray-200').forEach(el => {
                    el.classList.remove('bg-gray-50', 'bg-gray-100', 'bg-gray-200');
                    el.classList.add('bg-gray-800');
                });
                
                document.querySelectorAll('.border-gray-200, .border-gray-300').forEach(el => {
                    el.classList.remove('border-gray-200', 'border-gray-300');
                    el.classList.add('border-gray-700');
                });
            }
            
            // 禁用暗黑模式（恢复白天模式）
            function disableDarkMode() {
                themeIcon.classList.remove('fa-sun-o');
                themeIcon.classList.add('fa-moon-o');
                themeIcon.classList.remove('text-yellow-400');
                themeIcon.classList.add('text-dark');
                
                appBody.classList.remove('bg-darkBg', 'text-white');
                appBody.classList.add('bg-gray-50');
                
                mainNav.classList.remove('bg-darkCard', 'shadow-lg');
                mainNav.classList.add('bg-white', 'shadow-md');
                
                navTitle.classList.remove('text-white');
                navTitle.classList.add('text-dark');
                
                mainTitle.classList.remove('text-white');
                mainTitle.classList.add('text-dark');
                
                mainDesc.classList.remove('text-gray-300');
                mainDesc.classList.add('text-gray-600');
                
                mainFooter.classList.remove('bg-darkCard');
                mainFooter.classList.add('bg-dark');
                
                // 更新所有卡片样式
                themeCards.forEach(card => {
                    if (card) {
                        card.classList.remove('bg-darkCard', 'dark-shadow-card');
                        card.classList.add('bg-white', 'shadow-card');
                    }
                });
                
                // 更新所有文本元素样式
                document.querySelectorAll('p, h2, h3, h4, span, label').forEach(el => {
                    if (!el.classList.contains('text-primary') && 
                        !el.classList.contains('text-secondary') &&
                        !el.classList.contains('text-danger')) {
                        
                        el.classList.remove('text-gray-300');
                        // 恢复原始类
                        if (el.classList.contains('text-sm')) {
                            el.classList.add('text-gray-500');
                        } else {
                            el.classList.add('text-gray-600');
                        }
                        if (el.tagName === 'H2' || el.tagName === 'H3' || el.tagName === 'H4') {
                            el.classList.add('text-dark');
                        }
                    }
                });
                
                // 更新输入框样式
                document.querySelectorAll('input').forEach(input => {
                    input.classList.remove('border-gray-700', 'bg-gray-800', 'text-white');
                    input.classList.add('border-gray-300', 'bg-white');
                });
                
                // 更新各种背景元素
                document.querySelectorAll('.bg-gray-800').forEach(el => {
                    if (el.classList.contains('quality-option') || el.classList.contains('format-option')) {
                        el.classList.remove('bg-gray-800');
                        el.classList.add('bg-white');
                    } else {
                        el.classList.remove('bg-gray-800');
                        el.classList.add('bg-gray-50');
                    }
                });
                
                document.querySelectorAll('.border-gray-700').forEach(el => {
                    el.classList.remove('border-gray-700');
                    el.classList.add('border-gray-300');
                });
            }

            // 全局变量
            let selectedFile = null;
            let taskId = null;
            let processType = 'convert';
            let processingInterval = null;
            
            // DOM元素
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const selectFileBtn = document.getElementById('select-file-btn');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');
            const fileIcon = document.getElementById('file-icon');
            const removeFileBtn = document.getElementById('remove-file-btn');
            const processBtn = document.getElementById('process-btn');
            const processingSection = document.getElementById('processing');
            const resultSection = document.getElementById('result');
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = document.getElementById('progress-percentage');
            const processingInfo = document.getElementById('processing-info');
            const resultVideo = document.getElementById('result-video');
            const resultAudio = document.getElementById('result-audio');
            const downloadBtn = document.getElementById('download-btn');
            const newTaskBtn = document.getElementById('new-task-btn');
            const infoInputFile = document.getElementById('info-input-file');
            const infoOutputFormat = document.getElementById('info-output-format');
            const infoProcessType = document.getElementById('info-process-type');
            const infoProcessingTime = document.getElementById('info-processing-time');
            const historyContainer = document.getElementById('history-container');
            const cancelTaskBtn = document.getElementById('cancel-task-btn');
            
            // 选项卡元素
            const tabConvert = document.getElementById('tab-convert');
            const tabCompress = document.getElementById('tab-compress');
            const tabTrim = document.getElementById('tab-trim');
            const contentConvert = document.getElementById('content-convert');
            const contentCompress = document.getElementById('content-compress');
            const contentTrim = document.getElementById('content-trim');
            
            // 顶部导航菜单
            const navConvert = document.querySelector('a[href="#convert"]');
            const navCompress = document.querySelector('a[href="#compress"]');
            const navTrim = document.querySelector('a[href="#trim"]');
            const navHistory = document.querySelector('a[href="#history"]');
            const historySection = document.getElementById('history');
            
            // 统一的选项卡切换函数
            function switchToTab(tabElement, contentElement) {
                // 重置所有选项卡样式
                [tabConvert, tabCompress, tabTrim].forEach(tab => {
                    tab.classList.remove('border-primary', 'text-primary');
                    tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                // 隐藏所有内容区域
                [contentConvert, contentCompress, contentTrim].forEach(content => {
                    content.classList.add('hidden');
                });
                // 激活目标选项卡
                tabElement.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                tabElement.classList.add('border-primary', 'text-primary');
                contentElement.classList.remove('hidden');
            }
            
            // 绑定选项卡点击事件
            tabConvert.addEventListener('click', () => {
                switchToTab(tabConvert, contentConvert);
                processType = 'convert';
            });
            tabCompress.addEventListener('click', () => {
                switchToTab(tabCompress, contentCompress);
                processType = 'compress';
            });
            tabTrim.addEventListener('click', () => {
                switchToTab(tabTrim, contentTrim);
                processType = 'trim';
            });
            
            // 绑定顶部导航菜单点击事件
            navConvert.addEventListener('click', (e) => {
                e.preventDefault();
                switchToTab(tabConvert, contentConvert);
                processType = 'convert';
                contentConvert.scrollIntoView({ behavior: 'smooth' });
            });
            
            navCompress.addEventListener('click', (e) => {
                e.preventDefault();
                switchToTab(tabCompress, contentCompress);
                processType = 'compress';
                contentCompress.scrollIntoView({ behavior: 'smooth' });
            });
            
            navTrim.addEventListener('click', (e) => {
                e.preventDefault();
                switchToTab(tabTrim, contentTrim);
                processType = 'trim';
                contentTrim.scrollIntoView({ behavior: 'smooth' });
            });
            
            navHistory.addEventListener('click', (e) => {
                e.preventDefault();
                historySection.scrollIntoView({ behavior: 'smooth' });
            });
            
            // 文件上传处理
            selectFileBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
            
            // 拖放功能
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('border-primary');
                dropArea.classList.add('bg-gray-50');
            }
            
            function unhighlight() {
                dropArea.classList.remove('border-primary');
                dropArea.classList.remove('bg-gray-50');
            }
            
            dropArea.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }, false);
            
            function handleFile(file) {
                selectedFile = file;
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                
                // 根据文件类型设置图标
                if (file.type.startsWith('video/')) {
                    fileIcon.className = 'fa fa-file-video-o text-primary text-xl';
                } else if (file.type.startsWith('audio/')) {
                    fileIcon.className = 'fa fa-file-audio-o text-primary text-xl';
                } else {
                    fileIcon.className = 'fa fa-file-o text-primary text-xl';
                }
                
                fileInfo.classList.remove('hidden');
                processBtn.disabled = false;
            }
            
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else if (bytes < 1073741824) return (bytes / 1048576).toFixed(1) + ' MB';
                else return (bytes / 1073741824).toFixed(1) + ' GB';
            }
            
            removeFileBtn.addEventListener('click', () => {
                selectedFile = null;
                fileInfo.classList.add('hidden');
                processBtn.disabled = true;
            });
            
            // 处理按钮点击事件
            processBtn.addEventListener('click', async () => {
                if (!selectedFile) return;
                
                // 显示处理中页面
                processingSection.classList.remove('hidden');
                resultSection.classList.add('hidden');
                progressBar.style.width = '0%';
                progressPercentage.textContent = '0%';
                processingInfo.innerHTML = '<p>正在上传文件...</p>';
                
                // 上传文件
                const formData = new FormData();
                formData.append('file', selectedFile);
                
                try {
                    const uploadResponse = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!uploadResponse.ok) {
                        throw new Error('文件上传失败');
                    }
                    
                    const uploadData = await uploadResponse.json();
                    taskId = uploadData.task_id;
                    
                    // 准备处理参数
                    const processData = {
                        task_id: taskId,
                        process_type: processType
                    };
                    
                    // 根据处理类型添加特定参数
                    if (processType === 'convert') {
                        const selectedFormat = document.querySelector('input[name="format"]:checked').value;
                        processData.output_format = selectedFormat;
                    } else if (processType === 'compress') {
                        const selectedQuality = document.querySelector('input[name="quality"]:checked').value;
                        processData.quality = selectedQuality;
                    } else if (processType === 'trim') {
                        const startTime = document.getElementById('start-time').value;
                        const endTime = document.getElementById('end-time').value;
                        
                        processData.start_time = startTime;
                        processData.end_time = endTime;
                    }
                    
                    // 开始处理
                    processingInfo.innerHTML += '<p>文件上传完成，正在开始处理...</p>';
                    
                    const processResponse = await fetch('/process', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(processData)
                    });
                    
                    if (!processResponse.ok) {
                        throw new Error('处理请求失败');
                    }
                    
                    // 轮询检查处理状态
                    const startTime = Date.now();
                    processingInterval = setInterval(async () => {
                        try {
                            const statusResponse = await fetch(`/status/${taskId}`);
                            
                            if (!statusResponse.ok) {
                                throw new Error('获取状态失败');
                            }
                            
                            const statusData = await statusResponse.json();
                            
                            if (statusData.status === 'completed') {
                                clearInterval(processingInterval);
                                
                                const processingTime = ((Date.now() - startTime) / 1000).toFixed(1);
                                
                                // 更新结果页面
                                infoInputFile.textContent = selectedFile.name;
                                
                                if (processType === 'convert') {
                                    const selectedFormat = document.querySelector('input[name="format"]:checked').value;
                                    infoOutputFormat.textContent = selectedFormat.toUpperCase();
                                    infoProcessType.textContent = '格式转换';
                                } else if (processType === 'compress') {
                                    const selectedQuality = document.querySelector('input[name="quality"]:checked').value;
                                    infoOutputFormat.textContent = selectedFile.name.split('.').pop().toUpperCase();
                                    infoProcessType.textContent = `压缩 (${selectedQuality})`;
                                } else if (processType === 'trim') {
                                    infoOutputFormat.textContent = selectedFile.name.split('.').pop().toUpperCase();
                                    infoProcessType.textContent = '剪辑';
                                }
                                
                                infoProcessingTime.textContent = `${processingTime} 秒`;
                                
                                // 设置预览
                                const fileExt = statusData.output_file.split('.').pop().toLowerCase();
                                const isVideo = ['mp4', 'avi', 'mov', 'mkv', 'webm'].includes(fileExt);
                                const isAudio = ['mp3', 'wav', 'ogg', 'flac', 'm4a'].includes(fileExt);
                                
                                if (isVideo) {
                                    resultVideo.src = `/download/${statusData.output_file}`;
                                    resultVideo.classList.remove('hidden');
                                    resultAudio.classList.add('hidden');
                                } else if (isAudio) {
                                    resultAudio.src = `/download/${statusData.output_file}`;
                                    resultAudio.classList.remove('hidden');
                                    resultVideo.classList.add('hidden');
                                }
                                
                                // 设置下载链接
                                downloadBtn.href = `/download/${statusData.output_file}`;
                                downloadBtn.setAttribute('download', statusData.output_file);
                                
                                // 刷新历史记录
                                fetchHistory();
                                
                                // 显示结果页面
                                processingSection.classList.add('hidden');
                                resultSection.classList.remove('hidden');
                            } else if (statusData.status === 'error') {
                                clearInterval(processingInterval);
                                processingInfo.innerHTML += `<p class="text-danger">处理失败: ${statusData.error}</p>`;
                            } else {
                                // 更新进度（模拟，实际应从服务器获取）
                                const currentWidth = parseInt(progressBar.style.width);
                                const newWidth = Math.min(currentWidth + 5, 95);
                                progressBar.style.width = `${newWidth}%`;
                                progressPercentage.textContent = `${newWidth}%`;
                            }
                        } catch (error) {
                            clearInterval(processingInterval);
                            processingInfo.innerHTML += `<p class="text-danger">检查状态时出错: ${error.message}</p>`;
                        }
                    }, 2000);
                } catch (error) {
                    processingInfo.innerHTML += `<p class="text-danger">处理出错: ${error.message}</p>`;
                }
            });
            
            // 新任务按钮
            newTaskBtn.addEventListener('click', () => {
                resultSection.classList.add('hidden');
                selectedFile = null;
                fileInfo.classList.add('hidden');
                processBtn.disabled = true;
            });
            
            // 取消任务按钮
            cancelTaskBtn.addEventListener('click', () => {
                if (processingInterval) {
                    clearInterval(processingInterval);
                }
                processingSection.classList.add('hidden');
            });
            
            // 获取历史记录
            function fetchHistory() {
                fetch('/history')
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            historyContainer.innerHTML = '';
                            
                            data.forEach(task => {
                                const taskElement = document.createElement('div');
                                taskElement.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all-300';
                                
                                let processTypeName = '';
                                if (task.type === 'video') {
                                    processTypeName = '视频';
                                } else {
                                    processTypeName = '音频';
                                }
                                
                                if (task.process_type === 'convert') {
                                    processTypeName += '格式转换';
                                } else if (task.process_type === 'compress') {
                                    processTypeName += '压缩';
                                } else if (task.process_type === 'trim') {
                                    processTypeName += '剪辑';
                                }
                                
                                const date = new Date(task.created_at * 1000);
                                const formattedDate = date.toLocaleString();
                                
                                taskElement.innerHTML = `
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 rounded-md bg-gray-100 flex items-center justify-center mr-3 transition-all-300">
                                                <i class="fa fa-${task.type === 'video' ? 'file-video-o' : 'file-audio-o'} text-primary"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-dark truncate transition-all-300">${task.input_file}</h4>
                                                <p class="text-sm text-gray-500 transition-all-300">${processTypeName} - ${formattedDate}</p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <span class="px-2 py-1 text-xs rounded-full ${task.status === 'completed' ? 'bg-secondary/20 text-secondary' : task.status === 'processing' ? 'bg-primary/20 text-primary' : 'bg-danger/20 text-danger'}">
                                                ${task.status === 'completed' ? '已完成' : task.status === 'processing' ? '处理中' : '错误'}
                                            </span>
                                            ${task.status === 'completed' ? `<a href="/download/${task.output_file}" class="text-primary hover:text-primary/80 text-sm flex items-center">
                                                <i class="fa fa-download mr-1"></i> 下载
                                            </a>` : ''}
                                        </div>
                                    </div>
                                `;
                                
                                historyContainer.appendChild(taskElement);
                            });
                        } else {
                            historyContainer.innerHTML = `
                                <div class="text-center text-gray-500 py-8 transition-all-300">
                                    <i class="fa fa-clock-o text-3xl mb-3 transition-all-300"></i>
                                    <p class="transition-all-300">暂无处理历史</p>
                                </div>
                            `;
                        }
                    })
                    .catch(error => {
                        historyContainer.innerHTML = `
                            <div class="text-center text-gray-500 py-8 transition-all-300">
                                <i class="fa fa-exclamation-triangle text-3xl mb-3 text-danger"></i>
                                <p class="transition-all-300">获取历史记录失败: ${error.message}</p>
                            </div>
                        `;
                    });
            }
            
            // 初始化历史记录
            fetchHistory();
            
            // 格式选项卡单选功能
            document.querySelectorAll('.format-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.format-option').forEach(opt => {
                        opt.classList.remove('border-primary');
                        opt.classList.add('border-gray-200');
                        opt.querySelector('input').checked = false;
                    });
                    option.classList.remove('border-gray-200');
                    option.classList.add('border-primary');
                    option.querySelector('input').checked = true;
                });
            });
            
            // 质量选项卡单选功能
            document.querySelectorAll('.quality-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.quality-option').forEach(opt => {
                        opt.classList.remove('border-primary');
                        opt.classList.add('border-gray-200');
                        opt.querySelector('div div').classList.add('hidden');
                        opt.querySelector('input').checked = false;
                    });
                    option.classList.remove('border-gray-200');
                    option.classList.add('border-primary');
                    option.querySelector('div div').classList.remove('hidden');
                    option.querySelector('input').checked = true;
                });
            });
            
            // 初始化选择第一个格式和质量选项
            document.querySelector('.format-option').click();
            document.querySelector('.quality-option').click();
        });
    </script>
</body>
</html>